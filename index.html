<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
  <title>Waltikka</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
    crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" id="graph"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
</head>

<body>
  <header class="container">
    <div class="fusion-logo">
      <a class="fusion-logo-link" href="https://www.waltikka.fi/">

        <img src="https://www.waltikka.fi/wp-content/uploads/logo-2.png"
          srcset="https://www.waltikka.fi/wp-content/uploads/logo-2.png 1x, https://www.waltikka.fi/wp-content/uploads/waltikka-logo-retina.png 2x"
          width="243" height="90" style="max-height:90px;height:auto;" alt="Rantahotel Waltikka Logo"
          data-retina_logo_url="https://www.waltikka.fi/wp-content/uploads/waltikka-logo-retina.png"
          class="fusion-standard-logo">
      </a>
    </div>
  </header>
  <div class="white-box2 container justify-content-center">

    <div class="top-text">
      <h1>Sensors' Dashboard</h1>

      <div class="row">
        <div class="col">
          <div class="top-droplist">
            <div>
              <label for="sensor-select" style="font-size: small;">Filter:</label>
              <br>
              <select name="Sensors" id="sensor-select" style="padding: 15px 35px;">
                <option value="AllSensors">--All Sensors--</option>
                <option value="Sensor1">Sensor 1</option>
                <option value="Sensor2">Sensor 2</option>
                <option value="Sensor3">Sensor 3</option>
                <option value="Sensor4">Sensor 4</option>
                <option value="Sensor5">Sensor 5</option>
                <option value="Sensor6">Sensor 6</option>
                <option value="Sensor7">Sensor 7</option>
                <option value="Sensor8">Sensor 8</option>
                <option value="Sensor9">Sensor 9</option>
                <option value="Sensor10">Sensor 10</option>
                <option value="Sensor11">Sensor 11</option>
                <option value="Sensor12">Sensor 12</option>
                <option value="Sensor13">Sensor 13</option>
                <option value="Sensor14">Sensor 14</option>
                <option value="Sensor15">Sensor 15</option>
                <option value="Sensor16">Sensor 16</option>
                <option value="Sensor17">Sensor 17</option>
              </select>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="switchDiv">
            <button id="btn" class="btn btn-light switch" onclick="toggleHistorical()"
              style="margin-top: 15px;" type="text" name="datefilter">View Historical Data</button>
            <script>
              function toggleHistorical() {
                var btn = document.getElementById("btn");
                if (btn.innerHTML === "View Historical Data") {
                  btn.innerHTML = "View Real-time Dashboard";
                  displayHistoricalGraph();
                } else {
                  btn.innerHTML = "View Historical Data";
                }

                var x = document.getElementById("graph");
                if (x.style.display === "none") {
                  x.style.display = "block";
                } else {
                  x.style.display = "none";
                }
                var y = document.getElementById("realTime");
                if (y.style.display === "none") {
                  y.style.display = "flex";
                } else {
                  y.style.display = "none";
                }
              }

            </script>
          </div>

        </div>
      </div>
    </div>

    <!-- Script for rooms' data starts here-->

    <script>
      // Array of room IDs and corresponding names
      const rooms = [
        { id: 7, name: "Ala-aula" },
        { id: 8, name: "209" },
        { id: 9, name: "Ravintolasali" },
        { id: 10, name: "109" },
        { id: 11, name: "307" },
        { id: 12, name: "Alaravintola" },
        { id: 13, name: "Vuolle 1 neuvottelutila" },
        { id: 14, name: "Ala-aulan narikka" },
        { id: 15, name: "2. kerroksen aulatila" },
        { id: 16, name: "YlÃ¤ravintola lavan oikea puoli" },
        { id: 17, name: "Linno 1 ja 2 neuvottelutila" },
        { id: 18, name: "129" },
        { id: 19, name: "126" },
        { id: 20, name: "229" },
        { id: 21, name: "226" },
        { id: 22, name: "326" },
        { id: 23, name: "Linno 1 ja 2 neuvottelutila" },
      ];

      // Base URL for the API
      const baseUrl = "https://iot.research.hamk.fi/api/v1/hamk/rooms/tsdata";

      async function fetchRoomData(room) {
        // ... (your fetchRoomData function) ...
      }

      function displayRoomData(room, data) {
        // ... (your displayRoomData function) ...
      }

      async function fetchDataForAllRooms() {
        // ... (your fetchDataForAllRooms function) ...
      }

      document.addEventListener('DOMContentLoaded', () => {
        fetchDataForAllRooms();
      });

      setInterval(() => fetchDataForAllRooms(), 24 * 60 * 60000);

      function displayHistoricalGraph() {
        // ... (your historical graph code) ...
      }
    </script>

    <!--Sample powerBI report-->
    <!-- Include Chart.js -->


    <!-- Create a canvas element for the chart -->
    <canvas id="myChart"></canvas>

    <!-- JavaScript to initialize the chart -->
    <script>
      const xValues = [100, 200, 300, 400, 500, 600, 700, 800, 900, 1000];

      new Chart("myChart", {
        type: "line",
        data: {
          labels: xValues,
          datasets: [
            {
              data: [860, 1140, 1060, 1060, 1070, 1110, 1330, 2210, 7830, 2478],
              borderColor: "red",
              fill: false,
            },
            {
              data: [1600, 1700, 1700, 1900, 2000, 2700, 4000, 5000, 6000, 7000],
              borderColor: "green",
              fill: false,
            },
            {
              data: [300, 700, 2000, 5000, 6000, 4000, 2000, 1000, 200, 100],
              borderColor: "blue",
              fill: false,
            },
          ],
        },
        options: {
          legend: { display: false },
        },
      });
    </script>

    <!--Dismissing alerts-->
    <script>

      function dismissAlert(boxId) {
        //Replace blinking icon with static '!'
        const staticAlert = "<b> ! </b>";
        const boxElement = document.getElementById(boxId);
        boxElement.style.backgroundColor = "#66C1DC";
        boxElement.innerHTML = boxElement.innerHTML.replaceAll(/<span class="blink">.<\/span>/gu, staticAlert);
      }

    </script>

    <!--Dashboard layout-->
    <div id="realTime" class="row justify-content-around container">

      <script>
        for (let id = 7; id <= 23; id++) {
          document.getElementById("realTime").innerHTML += `
            <div class="col-xl-3 col-lg-4 col-md-6 d-flex justify-content-center">
              <div class="box" id="box-${id}" onclick="dismissAlert(this.id)">Sensor ${id}</div>
            </div>
            `;

        }
      </script>
    </div>
  </div>

  <div id="historicalDataGraph" class="container">
    <h2>Historical Data Graph</h2>
    <canvas id="historicalChart"></canvas>
  </div>

  <footer>
    <!--Log for testing
    <div id="counter"></div>
    <div id="log">pain</div>
    -->
  </footer>
</body>

</html>
